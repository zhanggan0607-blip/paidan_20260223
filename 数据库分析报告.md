# SSTCP 维保系统数据库分析报告

> 生成时间: 2026-02-19
> 数据库类型: PostgreSQL
> 数据库名称: tq

---

## 一、数据库概览

### 1.1 表统计

| 序号 | 表名 | 中文名称 | 记录数 | 说明 |
|------|------|----------|--------|------|
| 1 | customer | 客户信息表 | 6 | 存储客户单位基本信息 |
| 2 | dictionary | 字典表 | 34 | 系统字典配置 |
| 3 | inspection_item | 巡检事项表 | 30 | 巡检事项分类与内容 |
| 4 | maintenance_log | 维保日志表 | 1 | 维保工作日志记录 |
| 5 | maintenance_plan | 维保计划表 | 151 | 维保计划主表 |
| 6 | periodic_inspection | 定期巡检单表 | 151 | 定期巡检工单 |
| 7 | periodic_inspection_record | 定期巡检记录表 | 8 | 巡检单明细记录 |
| 8 | personnel | 人员信息表 | 8 | 系统人员信息 |
| 9 | project_info | 项目信息表 | 5 | 项目基本信息 |
| 10 | repair_tools_issue | 维修工具领用表 | 139 | 工具领用记录 |
| 11 | repair_tools_stock | 维修工具库存表 | 102 | 工具库存管理 |
| 12 | spare_parts_inbound | 备品备件入库表 | 101 | 备件入库记录 |
| 13 | spare_parts_stock | 备品备件库存表 | 101 | 备件库存管理 |
| 14 | spare_parts_usage | 备品备件领用表 | 70 | 备件领用记录 |
| 15 | spot_work | 零星用工单表 | 0 | 零星用工工单 |
| 16 | temporary_repair | 临时维修单表 | 1 | 临时维修工单 |
| 17 | user_dashboard_config | 用户仪表板配置表 | 0 | 用户界面配置 |
| 18 | work_plan | 工作计划表 | 4 | 统一工作计划管理 |

**总计: 18 张表, 922 条记录**

---

## 二、表结构详情

### 2.1 customer (客户信息表)

**功能说明**: 存储客户单位的基本联系信息

| 字段名 | 类型 | 可空 | 默认值 | 说明 |
|--------|------|------|--------|------|
| id | INTEGER | NO | 自增 | 主键ID |
| name | VARCHAR(100) | NO | - | 客户单位 |
| address | VARCHAR(200) | YES | - | 客户地址 |
| contact_person | VARCHAR(50) | NO | - | 客户联系人 |
| phone | VARCHAR(20) | NO | - | 客户联系方式 |
| contact_position | VARCHAR(50) | YES | - | 客户联系人职位 |
| remarks | TEXT | YES | - | 备注 |
| created_at | TIMESTAMP | NO | now() | 创建时间 |
| updated_at | TIMESTAMP | NO | now() | 更新时间 |

**对应API**: `/api/v1/customer`
- GET `/` - 获取客户列表(分页)
- GET `/{id}` - 获取客户详情
- POST `/` - 创建客户
- PUT `/{id}` - 更新客户
- DELETE `/{id}` - 删除客户

---

### 2.2 dictionary (字典表)

**功能说明**: 系统字典配置，存储各类下拉选项

| 字段名 | 类型 | 可空 | 默认值 | 说明 |
|--------|------|------|--------|------|
| id | BIGINT | NO | 自增 | 主键ID |
| dict_type | VARCHAR(50) | NO | - | 字典类型 |
| dict_key | VARCHAR(50) | NO | - | 字典键 |
| dict_value | VARCHAR(200) | NO | - | 字典值 |
| dict_label | VARCHAR(200) | NO | - | 字典标签 |
| sort_order | INTEGER | YES | 0 | 排序 |
| is_active | BOOLEAN | YES | true | 是否启用 |
| created_at | TIMESTAMP | NO | now() | 创建时间 |
| updated_at | TIMESTAMP | NO | now() | 更新时间 |

**字典类型示例**:
- `temporary_repair_status`: 临时维修状态(未进行/进行中/已完成)
- `plan_status`: 计划状态
- `execution_status`: 执行状态

**对应API**: `/api/v1/dictionary`
- GET `/type/{dict_type}` - 按类型获取字典
- GET `/all/list` - 获取所有字典(不分页)
- GET `/` - 获取字典列表(分页)
- GET `/{id}` - 获取字典详情
- POST `/` - 创建字典
- PUT `/{id}` - 更新字典
- DELETE `/{id}` - 删除字典

---

### 2.3 inspection_item (巡检事项表)

**功能说明**: 巡检事项分类，支持树形结构

| 字段名 | 类型 | 可空 | 默认值 | 说明 |
|--------|------|------|--------|------|
| id | INTEGER | NO | 自增 | 主键ID |
| item_code | VARCHAR(50) | NO | - | 事项编码(唯一) |
| item_name | VARCHAR(200) | NO | - | 事项名称 |
| item_type | VARCHAR(50) | NO | - | 事项类型 |
| level | INTEGER | YES | 1 | 层级(1-项目类型,2-系统类型,3-检查项) |
| parent_id | INTEGER | YES | - | 父节点ID(自关联) |
| check_content | TEXT | YES | - | 检查内容 |
| check_standard | TEXT | YES | - | 检查标准 |
| sort_order | INTEGER | YES | 0 | 排序 |
| created_at | TIMESTAMP | YES | now() | 创建时间 |
| updated_at | TIMESTAMP | YES | now() | 更新时间 |

**自关联关系**: `parent_id` -> `inspection_item.id`

**对应API**: `/api/v1/inspection-item`
- GET `/tree` - 获取巡检事项树形结构
- GET `/all/list` - 获取所有巡检事项
- GET `/` - 获取巡检事项列表(分页)
- GET `/{id}` - 获取巡检事项详情
- POST `/` - 创建巡检事项
- PUT `/{id}` - 更新巡检事项
- DELETE `/{id}` - 删除巡检事项

---

### 2.4 personnel (人员信息表)

**功能说明**: 系统人员信息管理

| 字段名 | 类型 | 可空 | 默认值 | 说明 |
|--------|------|------|--------|------|
| id | BIGINT | NO | 自增 | 主键ID |
| name | VARCHAR(50) | NO | - | 姓名 |
| gender | VARCHAR(10) | NO | - | 性别 |
| phone | VARCHAR(20) | YES | - | 联系电话 |
| department | VARCHAR(100) | YES | - | 所属部门 |
| role | VARCHAR(20) | NO | 运维人员 | 角色 |
| address | VARCHAR(200) | YES | - | 地址 |
| remarks | VARCHAR(500) | YES | - | 备注 |
| created_at | TIMESTAMP | NO | now() | 创建时间 |
| updated_at | TIMESTAMP | NO | now() | 更新时间 |

**角色类型**: 管理员、部门经理、材料员、运维人员

**对应API**: `/api/v1/personnel`
- GET `/all/list` - 获取所有人员(不分页)
- GET `/` - 获取人员列表(分页)
- GET `/{id}` - 获取人员详情
- POST `/` - 创建人员
- PUT `/{id}` - 更新人员
- DELETE `/{id}` - 删除人员

---

### 2.5 project_info (项目信息表) ⭐核心表

**功能说明**: 项目基本信息，是系统的核心主表

| 字段名 | 类型 | 可空 | 默认值 | 说明 |
|--------|------|------|--------|------|
| id | BIGINT | NO | 自增 | 主键ID |
| project_id | VARCHAR(50) | NO | - | 项目编号(唯一) |
| project_name | VARCHAR(200) | NO | - | 项目名称 |
| completion_date | DATETIME | NO | - | 开始日期 |
| maintenance_end_date | DATETIME | NO | - | 结束日期 |
| maintenance_period | VARCHAR(20) | NO | - | 维保频率 |
| client_name | VARCHAR(100) | NO | - | 客户单位名称 |
| address | VARCHAR(200) | NO | - | 客户地址 |
| project_abbr | VARCHAR(10) | YES | - | 项目简称 |
| project_manager | VARCHAR(50) | YES | - | 运维人员 |
| client_contact | VARCHAR(50) | YES | - | 客户联系人 |
| client_contact_position | VARCHAR(20) | YES | - | 客户联系人职位 |
| client_contact_info | VARCHAR(50) | YES | - | 客户联系方式 |
| created_at | DATETIME | YES | - | 创建时间 |
| updated_at | DATETIME | YES | - | 更新时间 |

**外键被引用关系**:
- `temporary_repair.project_id` -> 级联删除
- `spot_work.project_id` -> 级联删除
- `maintenance_plan.project_id` -> 级联删除
- `periodic_inspection.project_id` -> 级联删除
- `work_plan.project_id` -> 级联删除
- `maintenance_log.project_id` -> 级联删除

**对应API**: `/api/v1/project-info`
- GET `/` - 获取项目列表(分页)
- GET `/all/list` - 获取所有项目(不分页)
- GET `/{id}` - 获取项目详情
- POST `/` - 创建项目
- PUT `/{id}` - 更新项目
- DELETE `/{id}` - 删除项目(支持级联删除)

---

### 2.6 maintenance_plan (维保计划表) ⭐核心表

**功能说明**: 维保计划主表，管理定期维保计划

| 字段名 | 类型 | 可空 | 默认值 | 说明 |
|--------|------|------|--------|------|
| id | BIGINT | NO | 自增 | 主键ID |
| plan_id | VARCHAR(50) | NO | - | 计划编号(唯一) |
| plan_name | VARCHAR(200) | NO | - | 计划名称 |
| project_id | VARCHAR(50) | NO | - | 关联项目编号(FK) |
| project_name | VARCHAR(200) | YES | - | 项目名称 |
| plan_type | VARCHAR(20) | NO | - | 工单类型 |
| equipment_id | VARCHAR(50) | NO | - | 设备编号 |
| equipment_name | VARCHAR(200) | NO | - | 设备名称 |
| equipment_model | VARCHAR(100) | YES | - | 设备型号 |
| equipment_location | VARCHAR(200) | YES | - | 设备位置 |
| plan_start_date | DATETIME | NO | - | 计划开始日期 |
| plan_end_date | DATETIME | NO | - | 计划结束日期 |
| execution_date | DATETIME | YES | - | 执行日期 |
| next_maintenance_date | DATETIME | YES | - | 下次维保日期 |
| responsible_person | VARCHAR(50) | NO | - | 负责人 |
| responsible_department | VARCHAR(100) | YES | - | 负责部门 |
| contact_info | VARCHAR(50) | YES | - | 联系方式 |
| maintenance_content | TEXT | NO | - | 维保内容 |
| maintenance_requirements | TEXT | YES | - | 维保要求 |
| maintenance_standard | TEXT | YES | - | 维保标准 |
| plan_status | VARCHAR(20) | NO | - | 计划状态 |
| execution_status | VARCHAR(20) | NO | - | 执行状态 |
| completion_rate | INTEGER | YES | 0 | 完成率 |
| remarks | TEXT | YES | - | 备注 |
| inspection_items | TEXT | YES | - | 巡查项数据(JSON) |
| created_at | DATETIME | NO | now() | 创建时间 |
| updated_at | DATETIME | NO | now() | 更新时间 |

**外键关系**: `project_id` -> `project_info.project_id` (CASCADE)

**对应API**: `/api/v1/maintenance-plan`
- GET `/all/list` - 获取所有计划(不分页)
- GET `/project/{project_id}` - 按项目获取计划
- GET `/upcoming/list` - 获取即将到期的计划
- GET `/date-range/list` - 按日期范围获取计划
- GET `/` - 获取计划列表(分页)
- GET `/{id}` - 获取计划详情
- POST `/` - 创建计划
- PUT `/{id}` - 更新计划
- DELETE `/{id}` - 删除计划
- PATCH `/{id}/status` - 更新执行状态
- PATCH `/{id}/completion-rate` - 更新完成率

---

### 2.7 work_plan (工作计划表)

**功能说明**: 统一管理定期巡检、临时维修、零星用工的工作计划

| 字段名 | 类型 | 可空 | 默认值 | 说明 |
|--------|------|------|--------|------|
| id | BIGINT | NO | 自增 | 主键ID |
| plan_id | VARCHAR(50) | NO | - | 计划编号(唯一) |
| plan_type | VARCHAR(20) | NO | - | 工单类型(定期巡检/临时维修/零星用工) |
| project_id | VARCHAR(50) | NO | - | 项目编号(FK) |
| project_name | VARCHAR(200) | NO | - | 项目名称 |
| plan_start_date | DATETIME | NO | - | 计划开始日期 |
| plan_end_date | DATETIME | NO | - | 计划结束日期 |
| client_name | VARCHAR(100) | YES | - | 客户单位 |
| maintenance_personnel | VARCHAR(100) | YES | - | 运维人员 |
| status | VARCHAR(20) | NO | 未进行 | 状态 |
| filled_count | INTEGER | YES | 0 | 已填写检查项数量 |
| total_count | INTEGER | YES | 5 | 检查项总数量 |
| remarks | TEXT | YES | - | 备注 |
| created_at | DATETIME | NO | now() | 创建时间 |
| updated_at | DATETIME | NO | now() | 更新时间 |

**外键关系**: `project_id` -> `project_info.project_id` (CASCADE)

**对应API**: `/api/v1/work-plan`
- GET `/statistics` - 获取统计数据
- GET `/all/list` - 获取所有工作计划(不分页)
- GET `/` - 获取工作计划列表(分页)
- GET `/{id}` - 获取工作计划详情
- POST `/` - 创建工作计划
- PUT `/{id}` - 更新工作计划
- DELETE `/{id}` - 删除工作计划

---

### 2.8 periodic_inspection (定期巡检单表)

**功能说明**: 定期巡检工单主表

| 字段名 | 类型 | 可空 | 默认值 | 说明 |
|--------|------|------|--------|------|
| id | BIGINT | NO | 自增 | 主键ID |
| inspection_id | VARCHAR(50) | NO | - | 工单编号(唯一) |
| plan_id | VARCHAR(50) | YES | - | 关联维保计划编号(FK) |
| project_id | VARCHAR(50) | NO | - | 项目编号(FK) |
| project_name | VARCHAR(200) | NO | - | 项目名称 |
| plan_start_date | DATETIME | NO | - | 计划开始日期 |
| plan_end_date | DATETIME | NO | - | 计划结束日期 |
| client_name | VARCHAR(100) | YES | - | 客户单位 |
| maintenance_personnel | VARCHAR(100) | YES | - | 运维人员 |
| status | VARCHAR(20) | NO | 未进行 | 状态 |
| filled_count | INTEGER | YES | 0 | 已填写检查项数量 |
| total_count | INTEGER | YES | 5 | 检查项总数量 |
| execution_result | TEXT | YES | - | 发现问题 |
| remarks | VARCHAR(500) | YES | - | 处理结果 |
| signature | TEXT | YES | - | 用户签名(base64) |
| created_at | DATETIME | NO | now() | 创建时间 |
| updated_at | DATETIME | NO | now() | 更新时间 |

**外键关系**:
- `plan_id` -> `maintenance_plan.plan_id` (CASCADE)
- `project_id` -> `project_info.project_id` (CASCADE)

**编号规则**: `XJ-项目编号-年月日` (如: XJ-TQ20260117-20260117)

**对应API**: `/api/v1/periodic-inspection`
- GET `/all/list` - 获取所有巡检单(不分页)
- GET `/` - 获取巡检单列表(分页)
- GET `/{id}` - 获取巡检单详情
- POST `/` - 创建巡检单
- PUT `/{id}` - 更新巡检单
- PATCH `/{id}` - 部分更新巡检单
- DELETE `/{id}` - 删除巡检单

---

### 2.9 periodic_inspection_record (定期巡检记录表)

**功能说明**: 巡检单明细记录，存储具体巡检项的填写内容

| 字段名 | 类型 | 可空 | 默认值 | 说明 |
|--------|------|------|--------|------|
| id | BIGINT | NO | 自增 | 主键ID |
| inspection_id | VARCHAR(50) | NO | - | 巡检单编号(FK) |
| item_id | VARCHAR(50) | NO | - | 巡检项ID |
| item_name | VARCHAR(200) | YES | - | 巡检项名称 |
| inspection_item | VARCHAR(200) | YES | - | 巡查项 |
| inspection_content | TEXT | YES | - | 巡查内容 |
| check_content | TEXT | YES | - | 检查要求 |
| brief_description | TEXT | YES | - | 简要说明 |
| equipment_name | VARCHAR(200) | YES | - | 设备名称 |
| equipment_location | VARCHAR(200) | YES | - | 设备位置 |
| inspected | BOOLEAN | YES | false | 是否已处理 |
| photos | TEXT | YES | - | 照片URL列表(JSON) |
| inspection_result | TEXT | YES | - | 巡检结果 |
| created_at | DATETIME | NO | now() | 创建时间 |
| updated_at | DATETIME | NO | now() | 更新时间 |

**外键关系**: `inspection_id` -> `periodic_inspection.inspection_id` (CASCADE)

**对应API**: `/api/v1/periodic-inspection-record`

---

### 2.10 temporary_repair (临时维修单表)

**功能说明**: 临时维修工单管理

| 字段名 | 类型 | 可空 | 默认值 | 说明 |
|--------|------|------|--------|------|
| id | BIGINT | NO | 自增 | 主键ID |
| repair_id | VARCHAR(50) | NO | - | 维修单编号(唯一) |
| plan_id | VARCHAR(50) | YES | - | 关联维保计划编号(FK) |
| project_id | VARCHAR(50) | NO | - | 项目编号(FK) |
| project_name | VARCHAR(200) | NO | - | 项目名称 |
| plan_start_date | DATETIME | NO | - | 计划开始日期 |
| plan_end_date | DATETIME | NO | - | 计划结束日期 |
| client_name | VARCHAR(100) | YES | - | 客户单位 |
| maintenance_personnel | VARCHAR(100) | YES | - | 运维人员 |
| status | VARCHAR(20) | NO | 未进行 | 状态 |
| remarks | VARCHAR(500) | YES | - | 备注 |
| fault_description | TEXT | YES | - | 故障描述 |
| solution | TEXT | YES | - | 解决方案 |
| photos | TEXT | YES | - | 现场图片(JSON数组) |
| signature | TEXT | YES | - | 用户签字(Base64) |
| execution_date | DATETIME | YES | - | 执行日期 |
| created_at | DATETIME | NO | now() | 创建时间 |
| updated_at | DATETIME | NO | now() | 更新时间 |

**外键关系**:
- `plan_id` -> `maintenance_plan.plan_id` (CASCADE)
- `project_id` -> `project_info.project_id` (CASCADE)

**编号规则**: `WX-项目编号-年月日-序号` (如: WX-TQ20260117-20260219-001)

**对应API**: `/api/v1/temporary-repair`
- GET `/all/list` - 获取所有维修单(不分页)
- GET `/` - 获取维修单列表(分页)
- GET `/{id}` - 获取维修单详情
- POST `/` - 创建维修单
- PUT `/{id}` - 更新维修单
- PATCH `/{id}` - 部分更新维修单
- DELETE `/{id}` - 删除维修单

---

### 2.11 spot_work (零星用工单表)

**功能说明**: 零星用工工单管理

| 字段名 | 类型 | 可空 | 默认值 | 说明 |
|--------|------|------|--------|------|
| id | BIGINT | NO | 自增 | 主键ID |
| work_id | VARCHAR(50) | NO | - | 用工单编号(唯一) |
| plan_id | VARCHAR(50) | YES | - | 关联维保计划编号(FK) |
| project_id | VARCHAR(50) | NO | - | 项目编号(FK) |
| project_name | VARCHAR(200) | NO | - | 项目名称 |
| plan_start_date | DATETIME | NO | - | 计划开始日期 |
| plan_end_date | DATETIME | NO | - | 计划结束日期 |
| client_name | VARCHAR(100) | YES | - | 客户单位 |
| maintenance_personnel | VARCHAR(100) | YES | - | 运维人员 |
| status | VARCHAR(20) | NO | 未进行 | 状态 |
| remarks | VARCHAR(500) | YES | - | 备注 |
| created_at | DATETIME | NO | now() | 创建时间 |
| updated_at | DATETIME | NO | now() | 更新时间 |

**外键关系**:
- `plan_id` -> `maintenance_plan.plan_id` (CASCADE)
- `project_id` -> `project_info.project_id` (CASCADE)

**编号规则**: `YG-项目编号-年月日` (如: YG-TQ20260117-20260219)

**对应API**: `/api/v1/spot-work`
- GET `/all/list` - 获取所有用工单(不分页)
- GET `/` - 获取用工单列表(分页)
- GET `/workers` - 获取施工人员列表
- POST `/quick-fill` - 快速填报
- POST `/workers` - 保存施工人员信息
- GET `/{id}` - 获取用工单详情
- POST `/` - 创建用工单
- PUT `/{id}` - 更新用工单
- PATCH `/{id}` - 部分更新用工单
- DELETE `/{id}` - 删除用工单

---

### 2.12 maintenance_log (维保日志表)

**功能说明**: 维保工作日志记录

| 字段名 | 类型 | 可空 | 默认值 | 说明 |
|--------|------|------|--------|------|
| id | BIGINT | NO | 自增 | 主键ID |
| log_id | VARCHAR(50) | NO | - | 日志编号(唯一) |
| project_id | VARCHAR(50) | NO | - | 项目编号(FK) |
| project_name | VARCHAR(200) | NO | - | 项目名称 |
| log_type | VARCHAR(20) | NO | periodic | 日志类型(periodic/repair/spot) |
| log_date | DATETIME | NO | - | 日志日期 |
| work_content | TEXT | YES | - | 工作内容 |
| images | TEXT | YES | - | 现场照片(JSON数组) |
| remark | VARCHAR(500) | YES | - | 备注 |
| created_by | VARCHAR(100) | YES | - | 创建人 |
| is_deleted | BIGINT | YES | 0 | 是否删除(0否/1是) |
| created_at | DATETIME | NO | now() | 创建时间 |
| updated_at | DATETIME | NO | now() | 更新时间 |

**外键关系**: `project_id` -> `project_info.project_id` (CASCADE)

**对应API**: `/api/v1/maintenance-log`
- GET `/` - 获取日志列表(分页)
- GET `/all/list` - 获取所有日志(不分页)
- GET `/{id}` - 获取日志详情
- POST `/` - 创建日志
- PUT `/{id}` - 更新日志
- DELETE `/{id}` - 删除日志(软删除)

---

### 2.13 spare_parts_stock (备品备件库存表)

**功能说明**: 备品备件库存管理

| 字段名 | 类型 | 可空 | 默认值 | 说明 |
|--------|------|------|--------|------|
| id | BIGINT | NO | 自增 | 主键ID |
| product_name | VARCHAR(200) | NO | - | 产品名称 |
| brand | VARCHAR(100) | YES | - | 品牌 |
| model | VARCHAR(100) | YES | - | 产品型号 |
| unit | VARCHAR(20) | NO | 件 | 单位 |
| quantity | INTEGER | NO | 0 | 库存数量 |
| status | VARCHAR(20) | NO | 在库 | 状态(在库/已使用/缺货) |
| created_at | DATETIME | NO | now() | 创建时间 |
| updated_at | DATETIME | NO | now() | 更新时间 |

**对应API**: `/api/v1/spare-parts/stock`

---

### 2.14 spare_parts_inbound (备品备件入库表)

**功能说明**: 备品备件入库记录

| 字段名 | 类型 | 可空 | 默认值 | 说明 |
|--------|------|------|--------|------|
| id | BIGINT | NO | 自增 | 主键ID |
| inbound_no | VARCHAR(50) | NO | - | 入库单号(唯一) |
| product_name | VARCHAR(200) | NO | - | 产品名称 |
| brand | VARCHAR(100) | YES | - | 品牌 |
| model | VARCHAR(100) | YES | - | 产品型号 |
| quantity | INTEGER | NO | - | 入库数量 |
| supplier | VARCHAR(200) | YES | - | 供应商 |
| unit | VARCHAR(20) | NO | 件 | 单位 |
| user_name | VARCHAR(100) | NO | - | 入库人 |
| remarks | VARCHAR(500) | YES | - | 备注 |
| created_at | DATETIME | NO | now() | 入库时间 |

**对应API**: `/api/v1/spare-parts/inbound`

---

### 2.15 spare_parts_usage (备品备件领用表)

**功能说明**: 备品备件领用记录

| 字段名 | 类型 | 可空 | 默认值 | 说明 |
|--------|------|------|--------|------|
| id | BIGINT | NO | 自增 | 主键ID |
| product_name | VARCHAR(200) | NO | - | 产品名称 |
| brand | VARCHAR(100) | YES | - | 品牌 |
| model | VARCHAR(100) | YES | - | 产品型号 |
| quantity | INTEGER | NO | - | 领用数量 |
| user_name | VARCHAR(100) | NO | - | 运维人员 |
| issue_time | DATETIME | NO | - | 领用时间 |
| unit | VARCHAR(20) | NO | 件 | 单位 |
| project_id | VARCHAR(50) | YES | - | 项目编号 |
| project_name | VARCHAR(200) | YES | - | 项目名称 |
| stock_id | BIGINT | YES | - | 库存记录ID |
| status | VARCHAR(20) | NO | 已使用 | 状态 |
| created_at | DATETIME | NO | now() | 创建时间 |
| updated_at | DATETIME | NO | now() | 更新时间 |

**对应API**: `/api/v1/spare-parts/usage`

---

### 2.16 repair_tools_stock (维修工具库存表)

**功能说明**: 维修工具库存管理

| 字段名 | 类型 | 可空 | 默认值 | 说明 |
|--------|------|------|--------|------|
| id | BIGINT | NO | 自增 | 主键ID |
| tool_id | VARCHAR(50) | YES | - | 工具编号 |
| tool_name | VARCHAR(200) | NO | - | 工具名称 |
| category | VARCHAR(50) | YES | - | 工具分类 |
| specification | VARCHAR(200) | YES | - | 规格型号 |
| unit | VARCHAR(20) | NO | 个 | 单位 |
| stock | INTEGER | NO | 0 | 库存数量 |
| min_stock | INTEGER | YES | 5 | 最低库存预警 |
| location | VARCHAR(100) | YES | - | 存放位置 |
| status | VARCHAR(20) | NO | 已归还 | 状态(已归还/已领用/已损坏) |
| remark | TEXT | YES | - | 备注 |
| created_at | DATETIME | NO | now() | 创建时间 |
| updated_at | DATETIME | NO | now() | 更新时间 |

**对应API**: `/api/v1/repair-tools/stock`

---

### 2.17 repair_tools_issue (维修工具领用表)

**功能说明**: 维修工具领用记录

| 字段名 | 类型 | 可空 | 默认值 | 说明 |
|--------|------|------|--------|------|
| id | BIGINT | NO | 自增 | 主键ID |
| tool_id | VARCHAR(50) | YES | - | 工具编号 |
| tool_name | VARCHAR(200) | NO | - | 工具名称 |
| specification | VARCHAR(200) | YES | - | 规格型号 |
| quantity | INTEGER | NO | - | 领用数量 |
| return_quantity | INTEGER | YES | 0 | 归还数量 |
| user_id | BIGINT | YES | - | 运维人员ID |
| user_name | VARCHAR(100) | NO | - | 运维人员姓名 |
| issue_time | DATETIME | NO | - | 领用时间 |
| return_time | DATETIME | YES | - | 归还时间 |
| project_id | VARCHAR(50) | YES | - | 项目编号 |
| project_name | VARCHAR(200) | YES | - | 项目名称 |
| status | VARCHAR(20) | YES | 已领用 | 状态(已领用/已归还/已损坏) |
| remark | TEXT | YES | - | 备注 |
| stock_id | BIGINT | YES | - | 库存记录ID |
| created_at | DATETIME | NO | now() | 创建时间 |
| updated_at | DATETIME | NO | now() | 更新时间 |

**对应API**: `/api/v1/repair-tools/issue`

---

### 2.18 user_dashboard_config (用户仪表板配置表)

**功能说明**: 用户界面个性化配置

| 字段名 | 类型 | 可空 | 默认值 | 说明 |
|--------|------|------|--------|------|
| id | BIGINT | NO | 自增 | 主键ID |
| user_id | VARCHAR(100) | NO | - | 用户ID |
| dashboard_type | VARCHAR(50) | NO | - | 仪表板类型 |
| config | JSON | NO | - | 配置数据 |
| created_at | DATETIME | NO | now() | 创建时间 |
| updated_at | DATETIME | NO | now() | 更新时间 |

**对应API**: `/api/v1/user-dashboard-config`

---

## 三、表关系图

```
┌─────────────────┐
│  project_info   │ ◄─────────────────────────────────────────────┐
│  (项目信息表)    │                                               │
└────────┬────────┘                                               │
         │                                                        │
         │ 1:N (CASCADE)                                          │
         ▼                                                        │
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│ maintenance_plan│────►│periodic_inspection│   │  temporary_repair│
│  (维保计划表)    │     │  (定期巡检单表)   │     │  (临时维修单表)  │
└────────┬────────┘     └────────┬────────┘     └─────────────────┘
         │                       │
         │ 1:N                   │ 1:N
         ▼                       ▼
┌─────────────────┐     ┌─────────────────────────┐
│   spot_work     │     │periodic_inspection_record│
│ (零星用工单表)   │     │    (巡检记录表)          │
└─────────────────┘     └─────────────────────────┘

┌─────────────────┐
│ inspection_item │ ◄─── 自关联 (parent_id)
│  (巡检事项表)    │
└─────────────────┘

┌─────────────────┐     ┌─────────────────┐
│spare_parts_stock│◄───►│spare_parts_inbound│
│ (备件库存表)     │     │  (备件入库表)    │
└────────┬────────┘     └─────────────────┘
         │
         │ 关联
         ▼
┌─────────────────┐
│spare_parts_usage│
│ (备件领用表)     │
└─────────────────┘

┌─────────────────┐     ┌─────────────────┐
│repair_tools_stock│◄───►│repair_tools_issue│
│ (工具库存表)     │     │  (工具领用表)    │
└─────────────────┘     └─────────────────┘
```

---

## 四、业务流程说明

### 4.1 维保工单流程

```
项目信息维护 → 维保计划制定 → 工单生成 → 工单执行 → 工单提交 → 主管审批
                                                              ↓
                                              审批通过 ← 审批不通过(退回修改)
```

### 4.2 工单类型与编号规则

| 工单类型 | 前缀 | 编号格式 | 示例 |
|----------|------|----------|------|
| 定期巡检单 | XJ | XJ-项目编号-年月日 | XJ-TQ2023423-20251123 |
| 临时维修单 | WX | WX-项目编号-年月日-序号 | WX-TQ2023423-20251123-01 |
| 零星用工单 | YG | YG-项目编号-年月日 | YG-TQ2023423-20251123 |

### 4.3 权限控制

| 角色 | 权限范围 |
|------|----------|
| 管理员 | 全部数据可见可操作 |
| 部门经理 | 全部数据可见可操作 |
| 材料员 | 备品备件、维修工具管理 |
| 运维人员 | 仅查看自己负责的项目和工单 |

---

## 五、API接口汇总

### 5.1 基础数据管理

| 模块 | API前缀 | 主要功能 |
|------|---------|----------|
| 客户管理 | `/api/v1/customer` | 客户信息CRUD |
| 人员管理 | `/api/v1/personnel` | 人员信息CRUD |
| 项目管理 | `/api/v1/project-info` | 项目信息CRUD |
| 字典管理 | `/api/v1/dictionary` | 字典配置CRUD |
| 巡检事项 | `/api/v1/inspection-item` | 巡检事项树形管理 |

### 5.2 工单管理

| 模块 | API前缀 | 主要功能 |
|------|---------|----------|
| 维保计划 | `/api/v1/maintenance-plan` | 维保计划CRUD |
| 工作计划 | `/api/v1/work-plan` | 统一工作计划管理 |
| 定期巡检 | `/api/v1/periodic-inspection` | 巡检工单CRUD |
| 临时维修 | `/api/v1/temporary-repair` | 维修工单CRUD |
| 零星用工 | `/api/v1/spot-work` | 用工工单CRUD |
| 维保日志 | `/api/v1/maintenance-log` | 日志记录CRUD |

### 5.3 物资管理

| 模块 | API前缀 | 主要功能 |
|------|---------|----------|
| 备件库存 | `/api/v1/spare-parts` | 备件入库/领用/库存查询 |
| 工具管理 | `/api/v1/repair-tools` | 工具入库/领用/归还 |

---

## 六、数据完整性约束

### 6.1 外键约束 (CASCADE DELETE)

- 删除项目时，级联删除:
  - 维保计划 (maintenance_plan)
  - 定期巡检单 (periodic_inspection)
  - 临时维修单 (temporary_repair)
  - 零星用工单 (spot_work)
  - 工作计划 (work_plan)
  - 维保日志 (maintenance_log)

- 删除维保计划时，级联删除:
  - 定期巡检单 (periodic_inspection)
  - 临时维修单 (temporary_repair)
  - 零星用工单 (spot_work)

- 删除巡检单时，级联删除:
  - 巡检记录 (periodic_inspection_record)

### 6.2 唯一性约束

| 表名 | 唯一字段 |
|------|----------|
| project_info | project_id |
| maintenance_plan | plan_id |
| periodic_inspection | inspection_id |
| temporary_repair | repair_id |
| spot_work | work_id |
| maintenance_log | log_id |
| spare_parts_inbound | inbound_no |
| inspection_item | item_code |

---

## 七、索引优化

### 7.1 主要索引

| 表名 | 索引名 | 索引字段 |
|------|--------|----------|
| project_info | idx_project_info_id | project_id |
| project_info | idx_project_info_client_name | client_name |
| maintenance_plan | idx_maintenance_plan_id | plan_id |
| maintenance_plan | idx_maintenance_project_id | project_id |
| maintenance_plan | idx_maintenance_execution_date | execution_date |
| periodic_inspection | idx_periodic_inspection_id | inspection_id |
| periodic_inspection | idx_periodic_status | status |
| work_plan | idx_work_plan_type | plan_type |
| work_plan | idx_work_plan_status | status |

---

## 八、总结与建议

### 8.1 数据库设计特点

1. **核心表设计合理**: project_info 作为核心表，通过外键关联其他业务表
2. **级联删除机制**: 确保数据完整性，删除项目时自动清理关联数据
3. **软删除支持**: maintenance_log 表支持软删除(is_deleted字段)
4. **编号规则统一**: 工单编号遵循统一的命名规范

### 8.2 优化建议

1. **spot_work 表**: 当前记录数为0，建议验证业务流程是否正常
2. **user_dashboard_config 表**: 当前记录数为0，可考虑添加默认配置
3. **temporary_repair 表**: 记录数较少，建议检查业务使用情况
4. **索引优化**: 高频查询字段已建立索引，建议定期监控查询性能

---

*报告生成完毕*
